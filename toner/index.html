<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catálogo — Norttek Solutions</title>
<meta name="theme-color" content="#0a74da" />
<style>
  /* ========= PALETA NORTTEK (azul, negro, gris) ========= */
  :root{
    --brand:#0a74da;        /* azul Norttek */
    --brand-700:#095bb5;
    --bg:#0d1117;           /* fondo oscuro */
    --card:#161b22;         /* tarjetas */
    --border:#21262d;       /* borde gris oscuro */
    --text:#e6edf3;         /* texto claro */
    --muted:#9aa4af;        /* texto secundario */
    --ring: rgba(10,116,218,.35);
    --mark:#fff3a3;         /* resaltado */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* ========= HEADER ========= */
  header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg, #0a74da, #095bb5);
    color:white;
    padding:14px 16px;
    border-bottom:1px solid rgba(255,255,255,.15);
    box-shadow:0 6px 18px rgba(0,0,0,.25);
  }
  .head-wrap{
    max-width:1100px; margin:0 auto; display:flex; align-items:center; gap:12px;
  }
  .logo{
    width:36px; height:36px; border-radius:8px; display:grid; place-items:center;
    background:#fff; color:#0a74da; font-weight:900;
    box-shadow:0 4px 12px rgba(0,0,0,.25);
  }
  .title{font-size:clamp(16px,3.2vw,22px); font-weight:800; letter-spacing:.2px}
  .subtitle{font-size:12px; opacity:.9}

  /* ========= LAYOUT ========= */
  .wrap{max-width:1100px; margin:24px auto; padding:0 16px;}
  .toolbar{
    display:grid; gap:10px; align-items:center;
    grid-template-columns: 1fr auto auto;
  }
  @media (max-width: 720px){
    .toolbar{grid-template-columns: 1fr; gap:8px;}
  }

  /* ========= SEARCH ========= */
  .search{
    display:flex; align-items:center; gap:10px;
    background:var(--card); border:1px solid var(--border); border-radius:14px;
    padding:10px 12px; transition:border-color .2s, box-shadow .2s, transform .12s;
  }
  .search:focus-within{ border-color:var(--brand); box-shadow:0 0 0 6px var(--ring); transform:translateY(-1px); }
  .search input{
    flex:1; min-width:0; background:transparent; border:0; outline:0; color:var(--text); font-size:16px;
  }

  /* ========= BUTTONS / SWITCH ========= */
  .btn{
    border:1px solid var(--border); background:var(--brand); color:#fff;
    padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;
    transition:transform .12s, box-shadow .2s, background .2s, border-color .2s;
    box-shadow:0 10px 24px rgba(10,116,218,.25);
  }
  .btn:hover{ background:var(--brand-700); transform:translateY(-1px); }
  .btn.secondary{ background:transparent; color:var(--text); border-color:var(--border); box-shadow:none }
  .btn.secondary:hover{ background:#0f1622; }

  .switch{
    display:inline-flex; gap:10px; align-items:center;
    padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:var(--card);
    color:var(--text); font-size:14px;
  }
  .switch input{accent-color: var(--brand); width:18px; height:18px}

  /* ========= CHIPS ========= */
  .chips{display:flex; flex-wrap:wrap; gap:8px; margin:12px 0 6px}
  .chip{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px;
    background:#0f1723; border:1px solid var(--border); border-radius:999px; color:var(--text); font-size:13px;
    animation:pop .18s ease-out both;
  }
  .chip button{
    all:unset; cursor:pointer; color:#cbd5e1; font-weight:800; line-height:1; padding:0 2px;
  }
  @keyframes pop{ from{ transform:scale(.92); opacity:.4 } to{ transform:scale(1); opacity:1 } }

  /* ========= COUNTER ========= */
  .counter{ color:var(--muted); font-size:14px; margin: 6px 0 16px }

  /* ========= GRID / CARDS ========= */
  .grid{ display:grid; gap:14px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px;
    box-shadow:0 8px 20px rgba(0,0,0,.25);
    opacity:0; transform: translateY(8px); animation:in .24s ease-out forwards;
  }
  @keyframes in{ to{ opacity:1; transform:none } }
  .modelo{ font-size:18px; font-weight:800; color:#e8f2ff; letter-spacing:.2px }
  .imp{ color:#c2cbd6; margin-top:6px; line-height:1.5 }
  .meta{ color:var(--muted); font-size:12px; margin-top:10px }

  /* ========= EMPTY STATE ========= */
  .empty{
    background:var(--card); border:2px dashed var(--border); color:var(--muted);
    border-radius:16px; text-align:center; padding:26px;
  }

  /* ========= HIGHLIGHT ========= */
  mark{
    background:var(--mark);
    color:#1f2937; padding:0 2px; border-radius:3px;
    box-shadow:inset 0 -2px 0 rgba(0,0,0,.08);
    animation:hilite .6s ease-out;
  }
  @keyframes hilite{ from{ background:#fff8c6 } to{ background:var(--mark)} }

  /* ========= FOOTER TIP ========= */
  .tip{ color:var(--muted); font-size:12px; margin-top:12px }
  code{ background:#0f1622; padding:2px 6px; border-radius:6px; border:1px solid var(--border) }
</style>
</head>
<body>

<header>
  <div class="head-wrap">
    <div class="logo">N</div>
    <div>
      <div class="title">Catálogo de Cartuchos</div>
      <div class="subtitle">Norttek Solutions</div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="toolbar" role="search">
    <div class="search" aria-live="polite">
      <!-- ícono -->
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M21 21l-4.2-4.2m1.7-5.5a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0z" stroke="#7aa9e8" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input id="q" type="text" inputmode="search" placeholder="Ej: hp 85a p1102w / mf3010 / brother 2270" autocomplete="off" />
      <button class="btn secondary" id="clearBtn" title="Limpiar (Esc)">Limpiar</button>
      <button class="btn" id="demoBtn" title="Rellenar ejemplo">Demostración</button>
    </div>

    <label class="switch" title="Exigir que todas las palabras coincidan">
      <input type="checkbox" id="modeAll" checked />
      <span>Coincidan <b>todas</b> las palabras</span>
    </label>

    <label class="switch" title="Ordenar resultados por relevancia">
      <input type="checkbox" id="rankOn" checked />
      <span>Ordenar por relevancia</span>
    </label>
  </div>

  <div id="chips" class="chips" aria-live="polite"></div>
  <div id="count" class="counter"></div>

  <section id="grid" class="grid" aria-live="polite" aria-busy="false"></section>

  <p class="tip">Sugerencias: escribe palabras en cualquier orden (sin acentos). Ejemplo: <code>p1102 hp 85a</code>, <code>lbp 6030 canon</code>.</p>
</main>

<script>
/* ================== Datos de prueba ================== */
const productos = [
  { modelo: "HP 85A", impresoras: "HP LaserJet Pro P1102, P1102w, M1132, M1212nf" },
  { modelo: "Canon 725", impresoras: "Canon LBP6000, LBP6030, MF3010" },
  { modelo: "Brother TN-450", impresoras: "Brother HL-2240, HL-2270DW, MFC-7360N" },
  { modelo: "Samsung MLT-D111S", impresoras: "Samsung Xpress M2020, M2070" },
  { modelo: "Epson 664", impresoras: "Epson L100, L110, L120, L200, L210" },
  { modelo: "HP 78A", impresoras: "HP LaserJet Pro M1536dnf, P1566, P1606dn" },
  { modelo: "Canon 728", impresoras: "Canon i-SENSYS MF4450, MF4550d, MF4570dn, MF4580dn" },
  { modelo: "Brother TN-660", impresoras: "Brother HL-L2300D, HL-L2320D, DCP-L2540DW, MFC-L2700DW" },
  { modelo: "Samsung MLT-D104S", impresoras: "Samsung ML-1660, ML-1865, SCX-3200" },
  { modelo: "HP 12A", impresoras: "HP LaserJet 1010, 1012, 1015, 1020, 3015" }
];

/* ============== Utilidades de normalización (acentos/espacios) ============== */
function normalize(str){
  return str
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // quita acentos
    .replace(/[_\-.,/()]+/g,' ')                     // separadores -> espacio
    .toLowerCase().trim().replace(/\s+/g,' ');
}
function normalizeWithMap(str){
  let norm = '';
  const map = [];
  for (let i=0;i<str.length;i++){
    const out = str[i].normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    const low = out.toLowerCase();
    norm += low;
    for (let k=0;k<low.length;k++) map.push(i);
  }
  return { norm: normalize(norm), map };
}
function tokenize(q){
  return Array.from(new Set(
    normalize(q).split(' ').filter(Boolean)
  ));
}

/* ================== Resaltado preciso (case/acento-insensible) ================== */
function escapeHTML(s){ return s.replace(/[&<>"]/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m])); }

function highlight(original, terms){
  if (!terms.length) return escapeHTML(original);
  const { norm, map } = normalizeWithMap(original);
  const ranges = [];
  terms.forEach(t=>{
    let start = 0;
    while(true){
      const i = norm.indexOf(t, start);
      if (i === -1) break;
      const j = i + t.length - 1;
      ranges.push([map[i], map[j]+1]); // [ini, fin)
      start = i + 1;
    }
  });
  if (!ranges.length) return escapeHTML(original);
  // merge overlaps
  ranges.sort((a,b)=>a[0]-b[0]);
  const merged = [ranges[0]];
  for (let k=1;k<ranges.length;k++){
    const last = merged[merged.length-1], cur = ranges[k];
    if (cur[0] <= last[1]) last[1] = Math.max(last[1], cur[1]);
    else merged.push(cur);
  }
  let out = '', prev = 0;
  for (const [a,b] of merged){
    out += escapeHTML(original.slice(prev, a));
    out += '<mark>' + escapeHTML(original.slice(a, b)) + '</mark>';
    prev = b;
  }
  out += escapeHTML(original.slice(prev));
  return out;
}

/* ================== Búsqueda y ranking ================== */
function scoreItem(itemNorm, terms){
  // +2 por coincidencia en modelo, +1 en impresoras; suma por múltiples ocurrencias
  let score = 0;
  terms.forEach(t=>{
    let idx=0,c=0;
    while((idx=itemNorm.modelo.indexOf(t,idx))!==-1){ c++; idx=idx+1; }
    score += c*2;
    idx=0; c=0;
    while((idx=itemNorm.imp.indexOf(t,idx))!==-1){ c++; idx=idx+1; }
    score += c*1;
  });
  return score;
}

function filterAndRank(items, terms, requireAll, rank){
  const norms = items.map(it=>({
    raw: it,
    modelo: normalize(it.modelo),
    imp: normalize(it.impresoras)
  }));
  const filtered = norms.filter(n=>{
    if (!terms.length) return true;
    const has = t => n.modelo.includes(t) || n.imp.includes(t);
    return requireAll ? terms.every(has) : terms.some(has);
  });
  if (rank && terms.length){
    filtered.sort((a,b)=> scoreItem(b, terms) - scoreItem(a, terms));
  }
  return filtered.map(x=>x.raw);
}

/* ================== Render ================== */
const elQ = document.getElementById('q');
const elGrid = document.getElementById('grid');
const elCount = document.getElementById('count');
const elChips = document.getElementById('chips');
const modeAll = document.getElementById('modeAll');
const rankOn = document.getElementById('rankOn');
const clearBtn = document.getElementById('clearBtn');
const demoBtn = document.getElementById('demoBtn');

function renderChips(terms){
  elChips.innerHTML = '';
  terms.forEach(t=>{
    const chip = document.createElement('span');
    chip.className = 'chip';
    chip.innerHTML = `“${escapeHTML(t)}” <button title="Quitar término">×</button>`;
    chip.querySelector('button').addEventListener('click', ()=>{
      const rest = tokenize(elQ.value).filter(x=>x!==t);
      elQ.value = rest.join(' ');
      doSearch();
      elQ.focus();
    });
    elChips.appendChild(chip);
  });
}

function render(items, terms){
  elGrid.innerHTML = '';
  if (!items.length){
    elCount.textContent = '0 resultados';
    elGrid.innerHTML = `<div class="empty">
      <p><strong>Sin resultados.</strong></p>
      <p>Prueba con menos palabras, otras variantes (p. ej. "p1102" en vez de "P1102w") o sin acentos.</p>
    </div>`;
    return;
  }
  elCount.textContent = `${items.length} resultado${items.length!==1?'s':''}`;
  items.forEach((it, i)=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.style.animationDelay = `${Math.min(i, 6)*30}ms`;
    card.innerHTML = `
      <div class="modelo">${highlight(it.modelo, terms)}</div>
      <div class="imp">${highlight(it.impresoras, terms)}</div>
      <div class="meta">ID simulado: ${i+1} · Coincidencias: ${
        terms.map(t=>{
          const ok = normalize(it.modelo+' '+it.impresoras).includes(t);
          return ok ? '✔︎' : '—';
        }).join(' ')
      }</div>
    `;
    elGrid.appendChild(card);
  });
}

/* ================== Lógica de búsqueda con debounce ================== */
let debounceTimer = null;
function doSearch(){
  const terms = tokenize(elQ.value);
  renderChips(terms);
  const out = filterAndRank(productos, terms, modeAll.checked, rankOn.checked);
  render(out, terms);
}
function debouncedSearch(){
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(doSearch, 120);
}

/* ================== Eventos ================== */
elQ.addEventListener('input', debouncedSearch);
modeAll.addEventListener('change', doSearch);
rankOn.addEventListener('change', doSearch);
clearBtn.addEventListener('click', ()=>{
  elQ.value = '';
  doSearch();
  elQ.focus();
});
demoBtn.addEventListener('click', ()=>{
  elQ.value = 'p1102 hp láser pro';
  doSearch();
  elQ.focus();
});
window.addEventListener('keydown', e=>{
  if (e.key === 'Escape'){ clearBtn.click(); }
});

/* ================== Inicial ================== */
doSearch();
</script>
</body>
</html>
