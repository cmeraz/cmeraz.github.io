<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WhatsApp Pro Sender</title>
<link rel="shortcut icon" type="image/png" href="https://web.whatsapp.com/img/favicon_c5088e888c97ad440a61d247596f88e5.png">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="manifest" href="manifest.json">
<style>
  body, html {
    height: 100%;
    margin: 0;
    background: linear-gradient(-45deg, #6a11cb, #2575fc, #43e97b, #f8ff00);
    background-size: 800% 800%;
    animation: gradientAnim 30s ease infinite;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Segoe UI', sans-serif;
  }

  @keyframes gradientAnim {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .card {
    width: 100%;
    max-width: 480px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  }

  .dark-mode {
    filter: invert(1) hue-rotate(180deg);
  }

  /* Modal */
  .modal.is-active {
    display: flex;
  }

  .buttons-header {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }
</style>
</head>
<body>
<div class="card">
  <header class="card-header has-background-success">
    <p class="card-header-title has-text-white is-size-4">
      <i class="fab fa-whatsapp mr-2"></i> WhatsApp Pro Sender
    </p>
    <div class="buttons-header mr-2">
      <button class="button is-small is-light" onclick="toggleDarkMode()" title="Modo oscuro"><i class="fas fa-adjust"></i></button>
      <button class="button is-small is-light" onclick="openHelp()" title="Ayuda"><i class="fas fa-question-circle"></i></button>
    </div>
  </header>
  <div class="card-content">
    <!-- Selector de país -->
    <div class="field">
      <label class="label">País:</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select id="countryCode">
            <option value="52">🇲🇽 México (+52)</option>
            <option value="1">🇺🇸 USA (+1)</option>
            <option value="34">🇪🇸 España (+34)</option>
            <option value="57">🇨🇴 Colombia (+57)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Número -->
    <div class="field">
      <label class="label">Teléfono:</label>
      <div class="control has-icons-left">
        <input id="number" class="input" type="tel" placeholder="Número a 10 dígitos">
        <span class="icon is-small is-left"><i class="fas fa-phone"></i></span>
      </div>
    </div>

    <!-- Mensaje -->
    <div class="field">
      <label class="label">Mensaje:</label>
      <div class="control has-icons-left">
        <input id="message" class="input" type="text" placeholder="Escribe tu mensaje">
        <span class="icon is-small is-left"><i class="fas fa-comment-alt"></i></span>
      </div>
    </div>

    <!-- Mensajes rápidos -->
    <div class="buttons is-centered">
      <button class="button is-small is-info" onclick="quickMsg('Hola, ¿cómo estás?')">Saludo</button>
      <button class="button is-small is-warning" onclick="quickMsg('Envíame tu ubicación 📍')">Ubicación</button>
      <button class="button is-small is-danger" onclick="quickMsg('Lláma cuando puedas 📞')">Llamada</button>
    </div>

    <!-- Botones principales -->
    <div class="field is-grouped is-grouped-centered mt-3">
      <p class="control">
        <button id="sendBtn" class="button is-success"><i class="fas fa-paper-plane"></i> Enviar</button>
      </p>
      <p class="control">
        <button class="button is-light" onclick="clearInputs()"><i class="fas fa-eraser"></i> Limpiar</button>
      </p>
    </div>

    <!-- Historial -->
    <div class="mt-4">
      <p class="title is-6">Historial</p>
      <ul id="historyList" class="menu-list"></ul>
      <button class="button is-small is-danger mt-2" onclick="clearHistory()">Borrar historial</button>
    </div>
  </div>
</div>

<!-- Modal de ayuda -->
<div id="helpModal" class="modal">
  <div class="modal-background" onclick="closeHelp()"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">Ayuda</p>
      <button class="delete" aria-label="close" onclick="closeHelp()"></button>
    </header>
    <section class="modal-card-body">
      <ul>
        <li>Selecciona el país y escribe el número de teléfono (sin espacios ni guiones).</li>
        <li>Escribe el mensaje o usa los botones de mensajes rápidos.</li>
        <li>Haz clic en <b>Enviar</b> para abrir WhatsApp.</li>
        <li>El historial guarda tus últimos 10 mensajes para reutilizarlos.</li>
        <li>Usa <b>Limpiar</b> para borrar los campos.</li>
        <li>Activa <b>Modo oscuro</b> si quieres un fondo invertido.</li>
      </ul>
    </section>
    <footer class="modal-card-foot">
      <button class="button is-success" onclick="closeHelp()">Cerrar</button>
    </footer>
  </div>
</div>

<script>
  const numberInput = document.getElementById('number');
  const messageInput = document.getElementById('message');
  const historyList = document.getElementById('historyList');
  const countrySelect = document.getElementById('countryCode');

  // Modo oscuro
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
  }

  // Mensaje rápido
  function quickMsg(msg) {
    messageInput.value = msg;
  }

  // Guardar historial
  function saveHistory(num, msg) {
    let hist = JSON.parse(localStorage.getItem('whatsappHistory')) || [];
    hist.unshift({ num, msg, date: new Date().toLocaleString() });
    hist = hist.slice(0, 10);
    localStorage.setItem('whatsappHistory', JSON.stringify(hist));
    renderHistory();
  }

  // Mostrar historial
  function renderHistory() {
    historyList.innerHTML = '';
    const hist = JSON.parse(localStorage.getItem('whatsappHistory')) || [];
    hist.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `<a onclick="useHistory('${item.num}', '${item.msg}')">
        ${item.num} - ${item.msg} <small>(${item.date})</small>
      </a>`;
      historyList.appendChild(li);
    });
  }

  // Usar elemento del historial
  function useHistory(num, msg) {
    numberInput.value = num;
    messageInput.value = msg;
  }

  // Limpiar campos
  function clearInputs() {
    numberInput.value = '';
    messageInput.value = '';
    numberInput.focus();
  }

  // Borrar historial completo
  function clearHistory() {
    localStorage.removeItem('whatsappHistory');
    renderHistory();
  }

  // Enviar mensaje
  function sendMessage() {
    let num = numberInput.value.replace(/\D/g, '');
    const msg = messageInput.value.trim();
    const prefix = countrySelect.value;

    if (!/^\d{8,15}$/.test(num)) {
      alert('Número inválido. Ingresa entre 8 y 15 dígitos.');
      return;
    }

    if(msg === ''){
      alert('Escribe un mensaje antes de enviar');
      return;
    }

    saveHistory(num, msg);

    const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
    const url = isMobile
      ? `https://wa.me/${prefix}${num}?text=${encodeURIComponent(msg)}`
      : `https://web.whatsapp.com/send?phone=${prefix}${num}&text=${encodeURIComponent(msg)}`;

    window.open(url, '_blank');
  }

  document.getElementById('sendBtn').addEventListener('click', sendMessage);
  messageInput.addEventListener('keypress', function(e){
    if(e.key === 'Enter') sendMessage();
  });

  // Modal de ayuda
  function openHelp() {
    document.getElementById('helpModal').classList.add('is-active');
  }
  function closeHelp() {
    document.getElementById('helpModal').classList.remove('is-active');
  }

  window.onload = () => {
    renderHistory();
    numberInput.focus();
  };
</script>
</body>
</html>
